# #!/bin/sh

# set -e 
# set -x

# # This script calculates diversity metrics on a pre-generated response file.
# # IMPORTANT: It MUST be run AFTER reward_eval.sh has completed successfully.

# # --- Step 0: Configuration ---
# #export TRANSFORMERS_OFFLINE=1 # This is fine now, as no downloads are needed.
# export CUDA_VISIBLE_DEVICES="1" # Use a single FREE GPU (e.g., 1, 2, or 3)

# # --- Define Paths ---
# # This is the base directory of the model whose responses we are evaluating
# # MODEL_RESULTS_DIR="/data/ananthu/gem_project/results/qwen_1.5b_gem_run/output_dir"
# # MODEL_RESULTS_DIR="/data/ananthu/gem_project/results/qwen_1.5b_ce_run/output_dir"
# MODEL_RESULTS_DIR="/data/ananthu/gem_project/results/hybrid_alpha0.5_epochs3_topk3/output_dir"
# # The tokenizer is needed to analyze the responses
# TOKENIZER_PATH="/data/ananthu/gem_project/models/Qwen2-1.5B-Instruct"

# # --- IMPORTANT ---
# # This path points directly to the response file generated by reward_eval.sh
# RESPONSE_FILE_PATH="${MODEL_RESULTS_DIR}/evaluation_chat_alpaca/generated_responses.json"

# # Define a clean save directory for this specific evaluation's log
# SAVE_DIR="${MODEL_RESULTS_DIR}/evaluation_diversity_alpaca"
# mkdir -p $SAVE_DIR

# # --- Step 1: Evaluate Diversity on the Existing Responses ---
# echo "Calculating diversity metrics on responses from ${RESPONSE_FILE_PATH}"

# # Note the corrected path to the python script
# python evaluation/evaluation_diversity.py \
#     --tokenizer_path $TOKENIZER_PATH \
#     --detokenizer_path $TOKENIZER_PATH \
#     --response_path "${RESPONSE_FILE_PATH}" \
#     2>&1 | tee ${SAVE_DIR}/diversity_metrics.log

# echo "Diversity evaluation complete. Results saved in ${SAVE_DIR}"


#!/bin/sh
set -e; set -x;

# This is a template script. It expects the model path as the first argument.
MODEL_CHECKPOINT_PATH=$1

# --- Configuration ---
export CUDA_VISIBLE_DEVICES="2"
TOKENIZER_PATH="/data/ananthu/gem_project/models/Qwen2-1.5B-Instruct"
SAVE_DIR="${MODEL_CHECKPOINT_PATH}/evaluation_diversity_alpaca"
RESPONSE_FILE_PATH="${MODEL_CHECKPOINT_PATH}/evaluation_chat_alpaca/generated_responses.json"
mkdir -p $SAVE_DIR

echo "--- Calculating diversity for responses from ${RESPONSE_FILE_PATH} ---"

python evaluation/evaluation_diversity.py \
    --tokenizer_path $TOKENIZER_PATH \
    --detokenizer_path $TOKENIZER_PATH \
    --response_path "${RESPONSE_FILE_PATH}" \
    2>&1 | tee ${SAVE_DIR}/diversity_metrics.log